<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="distribution" content="global"/>
<meta name="robots" content="follow, all"/>
<meta name="language" content="en"/>
<title>
Brady &raquo; PHP &#8211; Active Directory &#8211; Reading UserAccountControl</title>
<meta name="generator" content="WordPress 3.9.9"/>
 
<link rel="shortcut icon" href="http://l3rady.com/blog/2009/09/14/php-active-directory-reading-useraccountcontrol/wp-content/favicon.ico" type="image/x-icon"/>
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed/rss/index.html"/>
<link rel="alternate" type="text/xml" title="RSS .92" href="feed/rss/index.html"/>
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="feed/atom/index.html"/>
<link rel="pingback" href="xmlrpc.php"/>
<link rel='archives' title='March 2011' href='blog/2011/03/index.html'/>
<link rel='archives' title='January 2011' href='blog/2011/01/index.html'/>
<link rel='archives' title='October 2010' href='blog/2010/10/index.html'/>
<link rel='archives' title='September 2010' href='blog/2010/09/index.html'/>
<link rel='archives' title='October 2009' href='blog/2009/10/index.html'/>
<link rel='archives' title='September 2009' href='blog/2009/09/index.html'/>
<link rel='archives' title='February 2009' href='blog/2009/02/index.html'/>
<link rel='archives' title='October 2008' href='blog/2008/10/index.html'/>
<link rel='archives' title='September 2008' href='blog/2008/09/index.html'/>
<link rel='archives' title='August 2008' href='blog/2008/08/index.html'/>
<link rel='archives' title='June 2008' href='blog/2008/06/index.html'/>
<link rel='archives' title='May 2008' href='blog/2008/05/index.html'/>
<link rel='archives' title='February 2008' href='blog/2008/02/index.html'/>
<script type="text/javascript">//<![CDATA[
            // Google Analytics for WordPress by Yoast v4.3.5 | http://yoast.com/wordpress/google-analytics/
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-25211555-1']);
				            _gaq.push(['_setCustomVar',2,'post_type','post',3],['_setCustomVar',3,'author','brady',3],['_setCustomVar',4,'year','2009',3],['_setCustomVar',5,'category','php',3],['_trackPageview']);
            (function () {
                var ga = document.createElement('script');
                ga.type = 'text/javascript';
                ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
            })();
            //]]></script>
<link rel="alternate" type="application/rss+xml" title="Brady &raquo; PHP &#8211; Active Directory &#8211; Reading UserAccountControl Comments Feed" href="blog/2009/09/14/php-active-directory-reading-useraccountcontrol/feed/index.html"/>
<link rel='stylesheet' id='mt-shcore-style-css' href='wp-content/plugins/syntax-highlighter-mt/styles/shCore.css%3Fver=2.2.4.css' type='text/css' media='all'/>
<link rel='stylesheet' id='mt-theme-style-css' href='wp-content/plugins/syntax-highlighter-mt/styles/shThemeDefault.css%3Fver=2.2.4.css' type='text/css' media='all'/>
<script type='text/javascript' src='wp-content/plugins/syntax-highlighter-mt/scripts/shCore.js%3Fver=2.2.4'></script>
<script type='text/javascript' src='wp-content/plugins/syntax-highlighter-mt/scripts/shAutoloader.js%3Fver=2.2.4'></script>
<script type='text/javascript' src='wp-includes/js/jquery/jquery.js%3Fver=1.11.0'></script>
<script type='text/javascript' src='wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.2.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php%3Frsd"/>
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml"/>
<link rel='prev' title='WSUS &#8211; Unable to connect to the server yourserver.yourdomain' href='index.html%3Fp=416.html'/>
<link rel='next' title='PHP &#8211; Get users SID from Active Directory via LDAP (objectsid)' href='index.html%3Fp=435.html'/>
<meta name="generator" content="WordPress 3.9.9"/>
<link rel='canonical' href='index.html%3Fp=432.html'/>
<link rel='shortlink' href='index.html%3Fp=432.html'/>
<link rel="StyleSheet" href="wp-content/themes/alphaready/style/resetCSS.css" type="text/css"/>
<link rel="StyleSheet" href="wp-content/themes/alphaready/style/alpha.css" type="text/css"/>
<!--[if lte IE 7.0]><link type="text/css" rel="stylesheet" href="/wp-content/themes/alphaready/style/alphaie7.css" /><![endif]-->
<!--[if lte IE 6.0]><link type="text/css" rel="stylesheet" href="/wp-content/themes/alphaready/style/alphaie6.css" /><![endif]-->
</head>
<body>
<div id="container">
<a href="index.html"><img src="wp-content/themes/alphaready/images/headerlogo.jpg" alt="Brady" title="Brady" border="0"/></a>
<div id="header-container">
<div id="slogan"><img src="wp-content/themes/alphaready/images/slogan.png" alt="A moan, a groan, my life story and how me, a technically minded person just can&#039;t seem to fit in with anybody." title="A moan, a groan, my life story and how me, a technically minded person just can&#039;t seem to fit in with anybody."/></div>
<div id="nav-container">
<ul id="navigation">
<li class='home' id='selected'><a href="index.html">HOME</a></li>
<li class='about'><a href="about-me.html">ABOUT ME</a></li>
<li class='webmail'><a href="http://webmail.alphaready.com">WEBMAIL</a></li>
<li class='sms'><a href="http://sms.alphaready.com">SMS GATEWAY</a></li>
<li class='proxy'><a href="http://proxy.alphaready.com">PROXY</a></li>
</ul>
<a href="cigarette.php.html"> </a>
</div>
</div>
<div id="content"> <div id="sidebar">
<ul id="ulside">
<li><h2 id="side01">ARCHIVES</h2>
<ul>
<li><a href='blog/2011/03/index.html'>March 2011</a></li>
<li><a href='blog/2011/01/index.html'>January 2011</a></li>
<li><a href='blog/2010/10/index.html'>October 2010</a></li>
<li><a href='blog/2010/09/index.html'>September 2010</a></li>
<li><a href='blog/2009/10/index.html'>October 2009</a></li>
<li><a href='blog/2009/09/index.html'>September 2009</a></li>
<li><a href='blog/2009/02/index.html'>February 2009</a></li>
<li><a href='blog/2008/10/index.html'>October 2008</a></li>
<li><a href='blog/2008/09/index.html'>September 2008</a></li>
<li><a href='blog/2008/08/index.html'>August 2008</a></li>
<li><a href='blog/2008/06/index.html'>June 2008</a></li>
<li><a href='blog/2008/05/index.html'>May 2008</a></li>
<li><a href='blog/2008/02/index.html'>February 2008</a></li>
</ul>
</li>
<li><h2 id="side02">CATEGORIES</h2>
<ul>
<li class="cat-item cat-item-8"><a href="blog/category/code-and-snippets/index.html" title="View all posts filed under Code and Snippets">Code and Snippets</a> (14)
<ul class='children'>
<li class="cat-item cat-item-18"><a href="blog/category/code-and-snippets/css/index.html" title="View all posts filed under CSS">CSS</a> (1)
</li>
<li class="cat-item cat-item-10"><a href="blog/category/code-and-snippets/html/index.html" title="View all posts filed under HTML">HTML</a> (3)
</li>
<li class="cat-item cat-item-11"><a href="blog/category/code-and-snippets/javascript/index.html" title="View all posts filed under JavaScript">JavaScript</a> (3)
</li>
<li class="cat-item cat-item-9"><a href="blog/category/code-and-snippets/php/index.html" title="View all posts filed under PHP">PHP</a> (8)
</li>
</ul>
</li>
<li class="cat-item cat-item-16"><a href="blog/category/how-to/index.html" title="View all posts filed under How to">How to</a> (1)
</li>
<li class="cat-item cat-item-6"><a href="blog/category/inner-geek/index.html" title="Don&#039;t enter here if you want some lite reading. This place is purly my inner geek talking.">Inner Geek</a> (4)
</li>
<li class="cat-item cat-item-14"><a href="blog/category/software/index.html" title="View all posts filed under Software">Software</a> (2)
</li>
</ul>
</li>
<li><h2 id="side03">META</h2>
<ul>
<li><a href="http://feeds.feedburner.com/l3rady/WyQw" title="Syndicate this site using RSS"><abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="wp-login.php.html">Log in</a></li>
</ul>
</li>
</ul>
</div>
<div id="main-content">
<div class="entry">
 
<h3 class="entrytitle" id="post-432"><a href="index.html%3Fp=432.html" rel="bookmark">PHP &#8211; Active Directory &#8211; Reading UserAccountControl</a></h3>
<div class="entrymeta">September 14th 2009 | Posted to <a href="blog/category/code-and-snippets/php/index.html" title="View all posts in PHP" rel="category tag">PHP</a> </div>
<div class="entrybody"><p>At the moment I&#8217;m doing a lot of work with Microsoft Active Directory and PHP. I&#8217;m building a few tools in PHP which reads data out of AD.</p>
<p>Now one of the things I wanted to read out was to see if the account was locked or if its password never expired. I couldn&#8217;t find these entries in AD but after searching those entries are stored in &#8220;useraccountcontrol&#8221;. But when I looked it was just a number. How does that number tell you if the account is locked?</p>
<p><a href="http://msdn.microsoft.com/en-us/library/ms680832(VS.85).aspx" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://msdn.microsoft.com']);">http://msdn.microsoft.com/en-us/library/ms680832(VS.85).aspx</a></p>
<p>On the above link is how that number is generated and once I understood that I got to work on writing a PHP script which translates that number into something more usable. Once I wrote the script I put it up on the Hot Scripts Forum to see if the code I wrote could be improved on and optimised. Here is what they came back with:</p>
<p>[PHP]<br/>
$userAccountArray = array(<br/>
&#8216;ADS_UF_TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION&#8217; => 0,<br/>
&#8216;ADS_UF_PASSWORD_EXPIRED&#8217; => 0,<br/>
&#8216;ADS_UF_DONT_REQUIRE_PREAUTH&#8217; => 0,<br/>
&#8216;ADS_UF_USE_DES_KEY_ONLY&#8217; => 0,<br/>
&#8216;ADS_UF_NOT_DELEGATED&#8217; => 0,<br/>
&#8216;ADS_UF_TRUSTED_FOR_DELEGATION&#8217; => 0,<br/>
&#8216;ADS_UF_SMARTCARD_REQUIRED&#8217; => 0,<br/>
&#8216;ADS_UF_MNS_LOGON_ACCOUNT&#8217; => 0,<br/>
&#8216;ADS_UF_DONT_EXPIRE_PASSWD&#8217; => 0,<br/>
&#8216;NOT_USED_8000&#8242; => 0,<br/>
&#8216;NOT_USED_4000&#8242; => 0,<br/>
&#8216;ADS_UF_SERVER_TRUST_ACCOUNT&#8217; => 0,<br/>
&#8216;ADS_UF_WORKSTATION_TRUST_ACCOUNT&#8217; => 0,<br/>
&#8216;ADS_UF_INTERDOMAIN_TRUST_ACCOUNT&#8217; => 0,<br/>
&#8216;ADS_UF_NORMAL_ACCOUNT&#8217; => 0,<br/>
&#8216;ADS_UF_TEMP_DUPLICATE_ACCOUNT&#8217; => 0,<br/>
&#8216;ADS_UF_ENCRYPTED_TEXT_PASSWORD_ALLOWED&#8217; => 0,<br/>
&#8216;ADS_UF_PASSWD_CANT_CHANGE&#8217; => 0,<br/>
&#8216;ADS_UF_PASSWD_NOTREQD&#8217; => 0,<br/>
&#8216;ADS_UF_LOCKOUT&#8217; => 0,<br/>
&#8216;ADS_UF_HOMEDIR_REQUIRED&#8217; => 0,<br/>
&#8216;NOT_USED_4&#8242; => 0,<br/>
&#8216;ADS_UF_ACCOUNTDISABLE&#8217; => 0,<br/>
&#8216;ADS_UF_SCRIPT&#8217; => 0<br/>
);</p>
<p>function ADUserAccountControl($val) {<br/>
global $userAccountArray;<br/>
$x = pow(2, count($userAccountArray) &#8211; 1);<br/>
foreach($userAccountArray as $k => $v) {<br/>
if(($val &#8211; $x) >= 0){<br/>
$userAccountArray[$k] = 1;<br/>
$val -= $x;<br/>
} else {<br/>
$userAccountArray[$k] = 0;<br/>
}<br/>
$x = $x / 2;<br/>
}<br/>
}<br/>
[/PHP]</p>
<p>Simply pass your useraccountcontrol value to the function and read the results out of the array.</p>
<p class="comments_link">
<a href="index.html%3Fp=432.html#respond" title="Comment on PHP &#8211; Active Directory &#8211; Reading UserAccountControl"><span class="dsq-postid" rel="432 http://l3rady.com/?p=432"><img src="wp-content/themes/alphaready/images/comments.gif" title="comments" alt="*"/> Comments(0)</span></a> </p>
</div>
 
</div>
<div id="disqus_thread">
</div>
<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://l3rady.com/blog/2009/09/14/php-active-directory-reading-useraccountcontrol/';
    var disqus_identifier = '432 http://l3rady.com/?p=432';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'l3rady';
    var disqus_title = "PHP &#8211; Active Directory &#8211; Reading UserAccountControl";
    var disqus_config = function () {
        var config = this; // Access to the config object
        config.language = '';

        /* Add the ability to add javascript callbacks */
        
        /*
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = '?cf_action=sync_comments&post_id=432';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/l3rady.com\/blog\/2009\/09\/14\/php-active-directory-reading-useraccountcontrol\/trackback\/"    };
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.' + 'disqus.com' + '/' + 'embed' + '.js' + '?pname=wordpress&pver=2.77';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>
<div class="entryother"></div>
</div>
<br style="clear:both"/>
 
</div>
</div>
<div id="footer">
<p><a href="http://www.alphaready.com"><img src="wp-content/themes/alphaready/images/ARfooter.jpg" alt="Alpha Ready" title="AlphavReady" border="0"/></a></p>
<p>Copyright &copy; 2008-2015 <a href="http://www.alphaready.com">Alpha Ready Ltd</a>. All rights reserved.</p>
</div>
<script type="text/javascript">
    // <![CDATA[
        var disqus_shortname = 'l3rady';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('rel'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) url = url[0];
                    else url = url[1]
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    //]]>
    </script>
<script type='text/javascript'>
/* <![CDATA[ */
var MTBrushParams = {"baseUrl":"http:\/\/l3rady.com\/wp-content\/plugins\/syntax-highlighter-mt"};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content/plugins/syntax-highlighter-mt/brushTypes.js%3Fver=2.2.4'></script>
</body>
</html>
