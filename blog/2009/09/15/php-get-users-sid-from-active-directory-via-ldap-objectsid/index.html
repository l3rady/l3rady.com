<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="distribution" content="global"/>
<meta name="robots" content="follow, all"/>
<meta name="language" content="en"/>
<title>
Brady &raquo; PHP &#8211; Get users SID from Active Directory via LDAP (objectsid)</title>
<meta name="generator" content="WordPress 3.9.9"/>
 
<link rel="shortcut icon" href="http://l3rady.com/blog/2009/09/15/php-get-users-sid-from-active-directory-via-ldap-objectsid/wp-content/favicon.ico" type="image/x-icon"/>
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="../../../../../feed/rss/index.html"/>
<link rel="alternate" type="text/xml" title="RSS .92" href="../../../../../feed/rss/index.html"/>
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="../../../../../feed/atom/index.html"/>
<link rel="pingback" href="../../../../../xmlrpc.php"/>
<link rel='archives' title='March 2011' href='../../../../2011/03/index.html'/>
<link rel='archives' title='January 2011' href='../../../../2011/01/index.html'/>
<link rel='archives' title='October 2010' href='../../../../2010/10/index.html'/>
<link rel='archives' title='September 2010' href='../../../../2010/09/index.html'/>
<link rel='archives' title='October 2009' href='../../../10/index.html'/>
<link rel='archives' title='September 2009' href='../../index.html'/>
<link rel='archives' title='February 2009' href='../../../02/index.html'/>
<link rel='archives' title='October 2008' href='../../../../2008/10/index.html'/>
<link rel='archives' title='September 2008' href='../../../../2008/09/index.html'/>
<link rel='archives' title='August 2008' href='../../../../2008/08/index.html'/>
<link rel='archives' title='June 2008' href='../../../../2008/06/index.html'/>
<link rel='archives' title='May 2008' href='../../../../2008/05/index.html'/>
<link rel='archives' title='February 2008' href='../../../../2008/02/index.html'/>
<script type="text/javascript">//<![CDATA[
            // Google Analytics for WordPress by Yoast v4.3.5 | http://yoast.com/wordpress/google-analytics/
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-25211555-1']);
				            _gaq.push(['_setCustomVar',2,'post_type','post',3],['_setCustomVar',3,'author','brady',3],['_setCustomVar',4,'year','2009',3],['_setCustomVar',5,'category','php',3],['_trackPageview']);
            (function () {
                var ga = document.createElement('script');
                ga.type = 'text/javascript';
                ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
            })();
            //]]></script>
<link rel="alternate" type="application/rss+xml" title="Brady &raquo; PHP &#8211; Get users SID from Active Directory via LDAP (objectsid) Comments Feed" href="feed/index.html"/>
<link rel='stylesheet' id='mt-shcore-style-css' href='../../../../../wp-content/plugins/syntax-highlighter-mt/styles/shCore.css%3Fver=2.2.4.css' type='text/css' media='all'/>
<link rel='stylesheet' id='mt-theme-style-css' href='../../../../../wp-content/plugins/syntax-highlighter-mt/styles/shThemeDefault.css%3Fver=2.2.4.css' type='text/css' media='all'/>
<script type='text/javascript' src='../../../../../wp-content/plugins/syntax-highlighter-mt/scripts/shCore.js%3Fver=2.2.4'></script>
<script type='text/javascript' src='../../../../../wp-content/plugins/syntax-highlighter-mt/scripts/shAutoloader.js%3Fver=2.2.4'></script>
<script type='text/javascript' src='../../../../../wp-includes/js/jquery/jquery.js%3Fver=1.11.0'></script>
<script type='text/javascript' src='../../../../../wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.2.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../../xmlrpc.php%3Frsd"/>
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../../wp-includes/wlwmanifest.xml"/>
<link rel='prev' title='PHP &#8211; Active Directory &#8211; Reading UserAccountControl' href='../../../../../index.html%3Fp=432.html'/>
<link rel='next' title='Microsoft Exchange &#8211; Recover deleted items from Outlook' href='../../../../../index.html%3Fp=437.html'/>
<meta name="generator" content="WordPress 3.9.9"/>
<link rel='canonical' href='../../../../../index.html%3Fp=435.html'/>
<link rel='shortlink' href='../../../../../index.html%3Fp=435.html'/>
<link rel="StyleSheet" href="../../../../../wp-content/themes/alphaready/style/resetCSS.css" type="text/css"/>
<link rel="StyleSheet" href="../../../../../wp-content/themes/alphaready/style/alpha.css" type="text/css"/>
<!--[if lte IE 7.0]><link type="text/css" rel="stylesheet" href="/wp-content/themes/alphaready/style/alphaie7.css" /><![endif]-->
<!--[if lte IE 6.0]><link type="text/css" rel="stylesheet" href="/wp-content/themes/alphaready/style/alphaie6.css" /><![endif]-->
</head>
<body><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="l3rady.com",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
<div id="container">
<a href="../../../../../index.html"><img src="../../../../../wp-content/themes/alphaready/images/headerlogo.jpg" alt="Brady" title="Brady" border="0"/></a>
<div id="header-container">
<div id="slogan"><img src="../../../../../wp-content/themes/alphaready/images/slogan.png" alt="A moan, a groan, my life story and how me, a technically minded person just can&#039;t seem to fit in with anybody." title="A moan, a groan, my life story and how me, a technically minded person just can&#039;t seem to fit in with anybody."/></div>
<div id="nav-container">
<ul id="navigation">
<li class='home' id='selected'><a href="../../../../../index.html">HOME</a></li>
<li class='about'><a href="../../../../../about-me.html">ABOUT ME</a></li>
<li class='webmail'><a href="http://webmail.alphaready.com">WEBMAIL</a></li>
<li class='sms'><a href="http://sms.alphaready.com">SMS GATEWAY</a></li>
<li class='proxy'><a href="http://proxy.alphaready.com">PROXY</a></li>
</ul>
<a href="../../../../../cigarette.php.html"> </a>
</div>
</div>
<div id="content"> <div id="sidebar">
<ul id="ulside">
<li><h2 id="side01">ARCHIVES</h2>
<ul>
<li><a href='../../../../2011/03/index.html'>March 2011</a></li>
<li><a href='../../../../2011/01/index.html'>January 2011</a></li>
<li><a href='../../../../2010/10/index.html'>October 2010</a></li>
<li><a href='../../../../2010/09/index.html'>September 2010</a></li>
<li><a href='../../../10/index.html'>October 2009</a></li>
<li><a href='../../index.html'>September 2009</a></li>
<li><a href='../../../02/index.html'>February 2009</a></li>
<li><a href='../../../../2008/10/index.html'>October 2008</a></li>
<li><a href='../../../../2008/09/index.html'>September 2008</a></li>
<li><a href='../../../../2008/08/index.html'>August 2008</a></li>
<li><a href='../../../../2008/06/index.html'>June 2008</a></li>
<li><a href='../../../../2008/05/index.html'>May 2008</a></li>
<li><a href='../../../../2008/02/index.html'>February 2008</a></li>
</ul>
</li>
<li><h2 id="side02">CATEGORIES</h2>
<ul>
<li class="cat-item cat-item-8"><a href="../../../../category/code-and-snippets/index.html" title="View all posts filed under Code and Snippets">Code and Snippets</a> (14)
<ul class='children'>
<li class="cat-item cat-item-18"><a href="../../../../category/code-and-snippets/css/index.html" title="View all posts filed under CSS">CSS</a> (1)
</li>
<li class="cat-item cat-item-10"><a href="../../../../category/code-and-snippets/html/index.html" title="View all posts filed under HTML">HTML</a> (3)
</li>
<li class="cat-item cat-item-11"><a href="../../../../category/code-and-snippets/javascript/index.html" title="View all posts filed under JavaScript">JavaScript</a> (3)
</li>
<li class="cat-item cat-item-9"><a href="../../../../category/code-and-snippets/php/index.html" title="View all posts filed under PHP">PHP</a> (8)
</li>
</ul>
</li>
<li class="cat-item cat-item-16"><a href="../../../../category/how-to/index.html" title="View all posts filed under How to">How to</a> (1)
</li>
<li class="cat-item cat-item-6"><a href="../../../../category/inner-geek/index.html" title="Don&#039;t enter here if you want some lite reading. This place is purly my inner geek talking.">Inner Geek</a> (4)
</li>
<li class="cat-item cat-item-14"><a href="../../../../category/software/index.html" title="View all posts filed under Software">Software</a> (2)
</li>
</ul>
</li>
<li><h2 id="side03">META</h2>
<ul>
<li><a href="http://feeds.feedburner.com/l3rady/WyQw" title="Syndicate this site using RSS"><abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="../../../../../wp-login.php.html">Log in</a></li>
</ul>
</li>
</ul>
</div>
<div id="main-content">
<div class="entry">
 
<h3 class="entrytitle" id="post-435"><a href="../../../../../index.html%3Fp=435.html" rel="bookmark">PHP &#8211; Get users SID from Active Directory via LDAP (objectsid)</a></h3>
<div class="entrymeta">September 15th 2009 | Posted to <a href="../../../../category/code-and-snippets/php/index.html" title="View all posts in PHP" rel="category tag">PHP</a> </div>
<div class="entrybody"><p>Have you ever needed to read an AD users SID so you can use it as the unique identifier it is?</p>
<p>Well I did but when I read out objectsid from AD for a user I found a load of weird symbols. It turned out that the data outputted was binary data. So after some digging around to see how to translate the binary data to a human readable SID like S-1-5-21-823795046-756116320-56781596-16683 I got to work to write a PHP script that could do just that.</p>
<p>This is what I came up with:</p>
<p>[PHP]$suffix =&#8221;@sub.mydomain.co.uk&#8221;;<br/>
$base_dn = &#8220;dc=sub,dc=mydomain,dc=co,dc=uk&#8221;;<br/>
$server = &#8220;127.0.0.1&#8243;;</p>
<p>$USERNAME = &#8220;username&#8221;;<br/>
$PASSWORD = &#8220;password&#8221;;</p>
<p>$USERNAMETOSEARCH = &#8220;user to get sid&#8221;;</p>
<p>$ds = ldap_connect($server);<br/>
ldap_set_option($ds, LDAP_OPT_PROTOCOL_VERSION, 3);<br/>
ldap_set_option($ds, LDAP_OPT_REFERRALS, 0);<br/>
$r = ldap_bind($ds, $USERNAME.$suffix, $PASSWORD);<br/>
$sr = ldap_search($ds, $base_dn, &#8220;(samaccountname=&#8221;.$USERNAMETOSEARCH.&#8221;)&#8221;);<br/>
$entries = ldap_get_entries($ds, $sr);</p>
<p>// All SID&#8217;s begin with S-<br/>
$sid = &#8220;S-&#8221;;<br/>
// Convert Bin to Hex and split into byte chunks<br/>
$sidinhex = str_split(bin2hex($entries[0]['objectsid'][0]), 2);<br/>
// Byte 0 = Revision Level<br/>
$sid = $sid.hexdec($sidinhex[0]).&#8221;-&#8221;;<br/>
// Byte 1-7 = 48 Bit Authority<br/>
$sid = $sid.hexdec($sidinhex[6].$sidinhex[5].$sidinhex[4].$sidinhex[3].$sidinhex[2].$sidinhex[1]);<br/>
// Byte 8 count of sub authorities &#8211; Get number of sub-authorities<br/>
$subauths = hexdec($sidinhex[7]);<br/>
//Loop through Sub Authorities<br/>
for($i = 0; $i < $subauths; $i++) {
	$start = 8 + (4 * $i);
	// X amount of 32Bit (4 Byte) Sub Authorities
	$sid = $sid.&#8221;-&#8221;.hexdec($sidinhex[$start+3].$sidinhex[$start+2].$sidinhex[$start+1].$sidinhex[$start]);
}

echo $sid;[/PHP]

Now this is written in PHP but I&#8217;m sure this code can be pretty much be translated to any other language.
</p>
        <p class="comments_link">
        <a href="../../../../../index.html%3Fp=435.html#comments" title="Comment on PHP &#8211; Get users SID from Active Directory via LDAP (objectsid)"><span class="dsq-postid" rel="435 http://l3rady.com/?p=435"><img src="../../../../../wp-content/themes/alphaready/images/comments.gif"  title="comments" alt="*" /> Comments(2)</span></a>        </p>
      </div>
      <!--<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="http://l3rady.com/blog/2009/09/15/php-get-users-sid-from-active-directory-via-ldap-objectsid/"
    dc:identifier="http://l3rady.com/blog/2009/09/15/php-get-users-sid-from-active-directory-via-ldap-objectsid/"
    dc:title="PHP &#8211; Get users SID from Active Directory via LDAP (objectsid)"
    trackback:ping="http://l3rady.com/blog/2009/09/15/php-get-users-sid-from-active-directory-via-ldap-objectsid/trackback/" />
</rdf:RDF>-->
    </div>

<div id="disqus_thread">
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://l3rady.com/blog/2009/09/15/php-get-users-sid-from-active-directory-via-ldap-objectsid/';
    var disqus_identifier = '435 http://l3rady.com/?p=435';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'l3rady';
    var disqus_title = "PHP &#8211; Get users SID from Active Directory via LDAP (objectsid)";
    var disqus_config = function () {
        var config = this; // Access to the config object
        config.language = '';

        /* Add the ability to add javascript callbacks */
        
        /*
           All currently supported events:
            * preData â€” fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = '?cf_action=sync_comments&post_id=435';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/l3rady.com\/blog\/2009\/09\/15\/php-get-users-sid-from-active-directory-via-ldap-objectsid\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.' + 'disqus.com' + '/' + 'embed' + '.js' + '?pname=wordpress&pver=2.77';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>
    <div class="entryother"></div>
  </div>
  <br style="clear:both" />
<!-- begin footer -->
  </div>
</div>
<div id="footer">
  <p><a href="http://www.alphaready.com"><img src="../../../../../wp-content/themes/alphaready/images/ARfooter.jpg" alt="Alpha Ready" title="AlphavReady" border="0" /></a></p>
  <p>Copyright &copy; 2008-2015 <a href="http://www.alphaready.com">Alpha Ready Ltd</a>. All rights reserved.</p>
</div>
    <script type="text/javascript">
    // <![CDATA[
        var disqus_shortname = 'l3rady';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('rel'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) url = url[0];
                    else url = url[1]
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    //]]>
    </script>
<script type='text/javascript'>
/* <![CDATA[ */
var MTBrushParams = {"baseUrl":"http:\/\/l3rady.com\/wp-content\/plugins\/syntax-highlighter-mt"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../../wp-content/plugins/syntax-highlighter-mt/brushTypes.js%3Fver=2.2.4'></script>
</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced
Object Caching 479/490 objects using disk

 Served from: l3rady.com @ 2015-12-30 23:29:46 by W3 Total Cache -->